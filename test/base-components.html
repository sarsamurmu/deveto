<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <meta charset="utf-8">
    <title>Base components</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="./resources/style.css" rel="stylesheet">
    <script src="./../dist/devoid.js"></script>
  </head>

  <body>
    <div renderBox></div>

    <label class="zust-checkbox themeToggle">
      <input type="checkbox" name="themeSwitch" id="themeSwitch" />
      <span></span>
      <span class="zust-unselectable">Dark Theme</span>
    </label>

    <script src="base.js"></script>
    <script type="text/javascript">
      window.addEventListener('DOMContentLoaded', () => {
        const {
          render,
          elements,
          Component,
          Fragment,
          createEl
        } = Devoid;

        const {
          div,
          p,
          button,
          a,
          br,
          textarea,
          h3,
          input
        } = elements;

        const {
          AsyncBuilder,
          ValueNotifier,
          ListenableBuilder,
          LifecycleBuilder,
          ChangeNotifier,
          Provider,
        } = Devoid;

        const valueListenerWidget = (context) => {
          const boxText = ValueNotifier({ value: 'This is initial value' });

          return new Fragment([
            new textarea({
              on: {
                input: (e) => {
                  boxText.value = e.target.value;
                },
              },
              props: {
                value: boxText.value,
                classList: ['zust-textarea'],
                placeholder: 'Enter some text'
              }
            }),
            new ListenableBuilder({
              listenTo: [boxText],
              builder: () => new Fragment([
                new p({
                  children: `The text you entered is ${boxText.value === '' ? 'Empty' : `"${boxText.value}"`}`
                }),
                `Value as text node - "${boxText.value}"`,
              ])
            })
          ]);
        }

        const lifecycleComponent = (context) => {
          return new LifecycleBuilder({
            didMount: () => {
              console.log(`Mounted Lifecycle Component`)
            },
            child: new Fragment([
              new p({
                children: 'Lifecycle Component'
              })
            ])
          });
        }

        class providerSample extends ChangeNotifier {
          constructor() {
            super();
            this._val = 10;
          }

          get val() {
            return this._val;
          }

          set val(newVal) {
            this._val = newVal;
            this.notifyListeners();
          }
        }

        class ThemeModel extends ChangeNotifier {
          constructor(color) {
            super();
            this.color = color;
          }
        }
        
        render(new div({
          children: [
            new h3({ children: 'Theme using Provider' }),
            new Provider({
              value: new ThemeModel('deepskyblue'),
              children: (context) => [
                new p({
                  style: {
                    color: Provider.of(context, ThemeModel).color
                  },
                  children: [
                    'Theming is cool',
                    new Provider({
                      value: new ThemeModel('tomato'),
                      children: (aContext) => new p({
                        style: {
                          color: Provider.of(aContext, ThemeModel).color
                        },
                        children: [
                          'It can change as deep it goes',
                          new p({
                            style: {
                              color: Provider.of(context, ThemeModel).color
                            },
                            children: 'But you can use parents theme if you got the context'
                          })
                        ]
                      })
                    })
                  ]
                }),
              ]
            }),
            new h3({ children: 'AsyncBuilder' }),
            new AsyncBuilder({
              getter: () =>  new Promise((resolve, reject) => {
                setTimeout(() => {
                  resolve('Job Done!');
                  console.log(`Really Done`);
                }, 2000);
              }),
              builder: (context, snapshot) => new Fragment([
                () => new p({ children: snapshot.hasData ? `Data is "${snapshot.data}"` : 'Data is loading...' }),
                () => snapshot.hasData && new p({ key: 'aPara', children: 'Load completed' }),
              ])
            }),
            new h3({ children: 'Lifecycle Component' }),
            lifecycleComponent,
            new h3({ children: 'ValueListener Component' }),
            valueListenerWidget,
            new h3({ children: 'Dynamic value with Provider' }),
            new Provider({
              value: new providerSample(),
              children: (context) => [
                new p({
                  children: `The value of Provider is - ${Provider.of(context, providerSample).val}`
                }),
                new div({
                  props: {
                    classList: 'zust-el-group'
                  },
                  children: [
                    new p({
                      props: {
                        classList: 'zust-form-el'
                      },
                      children: [
                        new input({
                          props: {
                            classList: 'zust-input',
                            placeholder: 'Enter new value'
                          },
                          on: {
                            input: (e) => {
                              Provider.of(context, providerSample).tempVal = e.target.value;
                            }
                          }
                        }),
                      ]
                    }),
                    new button({
                      props: {
                        classList: 'zust-btn zust-link'
                      },
                      on: {
                        click: () => {
                          Provider.of(context, providerSample).val = Provider.of(context, providerSample).tempVal;
                        }
                      },
                      children: 'Set value'
                    })
                  ]
                }),
              ],
            })
          ],
        }), document.querySelector('[renderBox]'));
      });

      // if (snapshot.hasData) {
      //     return new p({
      //       children: snapshot.data
      //     })
      //   }
      //   return new p({
      //     style: {
      //       color: 'var(--link-color)'
      //     },
      //     children: 'Data is loading...'
      //   })
    </script>
  </body>

</html>
