<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <meta charset="utf-8">
    <title>Duze</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="style.css" rel="stylesheet">
    <script src="./../dist/duze.js"></script>
  </head>

  <body>
    <div renderBox></div>

    <label class="zust-checkbox themeToggle">
      <input type="checkbox" name="themeSwitch" id="themeSwitch" />
      <span></span>
      <span class="zust-unselectable">Dark Theme</span>
    </label>

    <script src="base.js"></script>
    <script type="text/javascript">
      window.addEventListener('DOMContentLoaded', () => {
        const { render, elements, Component, baseComponents } = Duze;
        const { div, p, button, a, br, textarea } = elements;
        const { Builder, AsyncBuilder, Theme, ValueNotifier, ListenerBuilder } = baseComponents;

        let count = 1000;

        class CounterComponent extends Component {
          constructor({ child }) {
            super();
            this.child = child;
          }

          didMount() {
            console.log(`CounterComponent mounted`)
          }

          build(context) {
            return new p({
              style: {
                cursor: 'pointer',
                userSelect: 'none',
              },
              on: {
                click: () => {
                  this.setState(() => count += 1);
                }
              },
              children: [
                `Count is ${count}`,
                this.child,
              ]
            })
          }
        }

        class ChildComponent extends Component {
          didMount() {
            console.log(`ChildComponent mounted`)
          }

          build(context) {
            return new p({
              children: 'Child Component'
            })
          }
        }

        class ToggleComponent extends Component {
          init() {
            this.toggled = false;
          }

          didMount() {
            console.log(`Mounted`);
          }

          didUpdate() {
            console.log(`Updated`);
          }

          didDestroy() {
            console.log(`Destroyed`);
          }

          build(context) {
            return new div({
              children: this.toggled ? new button({
                children: 'Toggle to Anchor',
                on: {
                  click: () => this.setState(() => (this.toggled = !this.toggled))
                }
              }) : new a({
                children: 'Toggle to Button',
                on: {
                  click: () => this.setState(() => (this.toggled = !this.toggled))
                }
              })
            })
          }
        }

        const promiseGetter = () => new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve('Job Done!');
            console.log(`Really Done`);
          }, 2000);
        });

        const asyncComponent = new AsyncBuilder({
          getter: () => promiseGetter(),
          builder: (context, snapshot) => {
            if (snapshot.hasData) {
              return new p({
                children: snapshot.data
              })
            }
            return new p({
              style: {
                color: 'var(--link-color)'
              },
              children: 'Data is loading...'
            })
          }
        });

        const functionComponent = () => {
          let toggleState = false;
          return new p({
            on: {
              click() {
                this.setState(() => toggleState = !toggleState);
              }
            },
            children: () => new button({
              class: {
                transform: toggleState
              },
              attrs: {
                class: `zust-btn animated`,
                tabindex: -1,
              },
              children: toggleState ? 'Toggled' : 'Not toggled'
            })
          })
        }

        let divComp;
        const baseElement = new div({
          getComponent: (component) => divComp = component,
          children: [
            new button({
              on: {
                click: () => divComp.setState(),
              },
              attrs: {
                class: 'zust-btn',
              },
              children: 'Rebuild div'
            }),
            new CounterComponent({
              child: new ChildComponent()
            }),
            functionComponent,
            new ToggleComponent(),
            asyncComponent,
            new Theme({
              themeData: {
                color: 'blue',
              },
              child: (context) => new p({
                style: {
                  color: Theme.of(context).color
                },
                children: [
                  `Theme is cool`,
                  new Theme({
                    themeData: {
                      color: 'tomato',
                    },
                    child: (aContext) => new p({
                      style: {
                        color: Theme.of(aContext).color
                      },
                      children: [
                        `Nested Theme`,
                        new p({
                          style: {
                            color: Theme.of(context).color
                          },
                          children: `Deeply nested but using grandparent's color`
                        })
                      ]
                    })
                  })
                ]
              })
            }),
          ]
        });

        const valueListenerWidget = (context) => {
          const boxText = ValueNotifier('This is initial value');

          return new ListenerBuilder({
            listenTo: [boxText],
            child: new div({
              children: [
                new textarea({
                  on: {
                    input: (e) => {
                      boxText.value = e.target.value;
                    },
                  },
                  props: {
                    value: boxText.value,
                    classList: ['zust-textarea'],
                    placeholder: 'Enter some text'
                  }
                }),
                new p({
                  children: () => `The text you entered is ${boxText.value === '' ? 'Empty' : `"${boxText.value}"`}`
                }),
              ]
            })
          })
        }
        
        render(new div({
          children: valueListenerWidget
        }), document.querySelector('[renderBox]'));
      });
    </script>
  </body>

</html>
