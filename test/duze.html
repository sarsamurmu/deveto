<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <meta charset="utf-8">
    <title>Duze</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="style.css" rel="stylesheet">
    <script src="./../dist/duze.js"></script>
  </head>

  <body>
    <div renderBox></div>

    <label class="zust-checkbox themeToggle">
      <input type="checkbox" name="themeSwitch" id="themeSwitch" />
      <span></span>
      <span class="zust-unselectable">Dark Theme</span>
    </label>

    <script src="base.js"></script>
    <script type="text/javascript">
      window.addEventListener('DOMContentLoaded', () => {
        const { render, elements, Component, baseComponents } = Duze;
        const { div, p, button, a, br } = elements;
        const { Builder, AsyncBuilder, Theme } = baseComponents;

        let count = 1000;

        class CounterComponent extends Component {
          didMount() {
            console.log(`CounterComponent mounted`)
          }

          build(context) {
            return p({
              style: {
                cursor: 'pointer',
                userSelect: 'none',
              },
              events: {
                click: () => {
                  this.setState(() => count += 1);
                }
              },
              children: [
                `Count is ${count}`,
                this.componentData.child,
              ]
            })
          }
        }

        class ChildComponent extends Component {
          didMount() {
            console.log(`ChildComponent mounted`)
          }

          build(context) {
            return p({
              children: 'Child Component'
            })
          }
        }

        class ToggleComponent extends Component {
          init() {
            this.toggled = false;
          }

          didMount() {
            console.log(`Mounted`);
          }

          didUpdate() {
            console.log(`Updated`);
          }

          didDestroy() {
            console.log(`Destroyed`);
          }

          build(context) {
            return div({
              children: this.toggled ? button({
                children: 'Toggle to Anchor',
                events: {
                  click: () => this.setState(() => (this.toggled = !this.toggled))
                }
              }) : a({
                children: 'Toggle to Button',
                events: {
                  click: () => this.setState(() => (this.toggled = !this.toggled))
                }
              })
            })
          }
        }

        const promiseGetter = () => new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve('Job Done!');
            console.log(`Really Done`);
          }, 2000);
        });

        const asyncComponent = AsyncBuilder({
          getter: () => promiseGetter(),
          builder: (context, snapshot) => {
            if (snapshot.hasData) {
              return p({
                children: snapshot.data
              })
            }
            return p({
              style: {
                color: 'var(--link-color)'
              },
              children: 'Data is loading...'
            })
          }
        });

        const functionComponent = () => {
          let toggleState = false;
          return p({
            events: {
              click() {
                this.setState(() => toggleState = !toggleState);
              }
            },
            children: () => button({
              attrs: {
                class: [toggleState && 'transform', 'animated'],
              },
              children: toggleState ? 'Toggled' : 'Not toggled'
            })
          })
        }

        let divComp;

        render(div({
          getComponent: (component) => divComp = component,
          children: [
            button({
              events: {
                click: () => divComp.setState(),
              },
              children: 'Rebuild div'
            }),
            new CounterComponent({
              child: new ChildComponent()
            }),
            functionComponent,
            new ToggleComponent(),
            asyncComponent,
            Theme({
              themeData: {
                color: 'blue',
              },
              child: (context) => p({
                style: {
                  color: Theme.of(context).color
                },
                children: [
                  `Theme is cool`,
                  Theme({
                    themeData: {
                      color: 'tomato',
                    },
                    child: (aContext) => p({
                      style: {
                        color: Theme.of(aContext).color
                      },
                      children: [
                        `Nested Theme`,
                        p({
                          style: {
                            color: Theme.of(context).color
                          },
                          children: `Deeply nested but using grandparent's color`
                        })
                      ]
                    })
                  })
                ]
              })
            })
          ]
        }), document.querySelector('[renderBox]'));
      });
    </script>
  </body>

</html>
